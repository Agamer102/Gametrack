{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}Update{% endblock %}</h1>
{% endblock %}

{% block content %}
<div class="modal fade" id="addCustomGame" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
        <div class="modal-header">
            Add a custom game
        </div>
        <div class="modal-body">
          <p>
            For games not on Steam on VNDB, you can find them on a site like 
            <a href="https://thegamesdb.net">thegamesdb.net</a>
            Copy the name and cover image link, and use them here. 
            The games you add will only be visible to you.
            Please make sure the image link works and that the name is correct.
          </p>
            <form id="addCustomGameForm" method="post">
                <div class="mb-3" data-mdb-input-init>
                    <label class="col-form-label">Name:</label>
                    <input type="text" class="form-control" name="name" id="name">
                </div>
                <div class="mb-3" data-mdb-input-init>
                  <label class="col-form-label">Image Link:</label>
                  <input type="text" class="form-control" name="image_link" id="imageLink">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" form="addCustomGameForm" class="btn btn-primary">Link</button>
        </div>
    </div>
  </div>
</div>

<div class="card mb-3">
    {% for result in results %}
    {% if loop.index <= 20 %}
      {% if result.steam_appid  and result.vndbid %}
      <div class="row g-0">
        <div class="col-md-4">
          <img src="https://steamcdn-a.akamaihd.net/steam/apps/{{ result.steam_appid }}/header.jpg" class="img-fluid rounded-start" alt="">
        </div>
        <div class="col-md-8">
          <div class="card-body">
            <h5 class="card-title">{{ result.name }}</h5>
            <p class="card-text">Steam AppID {{ result.steam_appid }}</p>
            <p class="card-text">VNDB ID {{ result.vndbid }}</p>
      {% elif result.steam_appid %}
      <div class="row g-0">
        <div class="col-md-4">
          <img src="https://steamcdn-a.akamaihd.net/steam/apps/{{ result.steam_appid }}/header.jpg" class="img-fluid rounded-start" alt="">
        </div>
        <div class="col-md-8">
          <div class="card-body">
            <h5 class="card-title">{{ result.name }}</h5>
            <p class="card-text">Steam AppID {{ result.steam_appid }}</p>
      {% elif result.vndbid %}
      <div class="row g-0">
        <div class="col-md-4">
          <img src="{{ result.image }}" class="img-fluid rounded-start" alt="">
        </div>
        <div class="col-md-8">
          <div class="card-body">
            <h5 class="card-title">{{ result.title_rm if result.title_rm else result.title_en }}</h5>
            <p class="card-text">Steam AppID {{ result.vndbid }}</p>
      {% endif %}
            <button 
            class="btn btn-secondary" 
            data-bs-toggle="modal" 
            data-bs-target="#updateGameModal" 
            data-bs-gameid="{{ result.id }}" 
            data-bs-gamename="{{ result.name if result.name is not none else result.title_rm }}" 
            data-bs-gamesteamid="{{ result.steam_appid if result.steam_appid is not none else '' }}"
            data-bs-gamevndbid="{{ result.vndbid if result.vndbid is not none else '' }}"
            data-bs-gametime="0"
            data-bs-gamerating="''">
              Add
            </button>
          </div>
        </div>
      </div>
    {% endif %}
    {% endfor %}
    {% if results|length > 20 %}
    <p>{{ results|length - 20 }} more results available</p>
    {% endif %}
</div>
{% endblock %}